#!/bin/sh

chown root:wheel /usr/libexec/zebra/supersling
chmod 6755 /usr/libexec/zebra/supersling

# Verify firmware.sh permissions
chown root:wheel /usr/libexec/zebra/firmware.sh 
chmod 6755 /usr/libexec/zebra/firmware.sh

# Verify startup permissions (Auto-install etc)
chown root:wheel /usr/libexec/zebra/startup
chmod 6755 /usr/libexec/zebra/startup

# Setup Launch Daemon
chown root:wheel /Library/LaunchDaemons/xyz.willy.Zebra.Startup.plist
chmod 644 /Library/LaunchDaemons/xyz.willy.Zebra.Startup.plist

# Prevent Zebra from choosing a sandbox path for its directory
if [ -f /var/mobile/Containers/Data/Application/*/Documents/zebra.db ];then
    DBPATH=$(ls /var/mobile/Containers/Data/Application/*/Documents/zebra.db)
    ZBPATH=${DBPATH/Documents\/zebra.db/}
    rm -rf ${ZBPATH}
    echo "Removed sandboxed Zebra document directory"
fi

# Create Documents directory if it does not already exist
mkdir -p /var/mobile/Documents

# I don't like this but why are people's doc directory owned by root??
chown mobile:mobile /var/mobile/Documents
chmod 0755 /var/mobile/Documents

# I really don't like this, but its the only way to ensure alternate icons are available -MNC
uicache -p /Applications/Zebra.app